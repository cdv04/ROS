---
title: "Comparaison des ratio ROS observé en condition témoin et en condition exposé"
author: "Claire Della Vedova"
date: "19 septembre 2017"
output: html_document
---

##1) Design expérimental

Les niveaux de ROS sont mesurés sur 4 échantillons :

* 10 larves témoin en activité basale
* 10 larves témoin en activité stimulée
* 10 larves HTO en activité basale
* 10 larves HTO en activité stimulée

La variable d'intéret est le ratio du niveau de ROS en activité basale sur le niveau de ROS en activité stimulée. Et de comparer les conditions contrôle et HTO.
 


##2) Principe de l'analyse
Je propose de calculer la moyenne des niveaux de ROS des 4 échantillons, puis de calculer le ratio de la moyenne basale sur la moyenne stimulé pour les témoins et les HTO. Il s'agira des ratio observés.

Je propose ensuite d'échantillonner 1000 fois par tirage boostrap, chacun des 4 échantillons,  et de calculer les deux ratios. Nous obtiendrons 1000 ratios contrôle et 1000 ratio témoins. Ces ratios issus du bootstrap nous servirons à calculer les Intervalles de confiances des ratios observés.

Si les intervalles de confiances des ratios contrôle et stimulé ne se chevauchent pas, nous pourrons conclure que les ratios sont significativement différents.En revanche, si ils se chevauchent, nous ne pourrons seulement que dire que nous n'avons pas pu mettre en évidence une différence, que cela peut être du à un manque de puissance (les tests statistiques sont plus précis que la méthode du chevauchement.) . Dans ce cas je réfléchirais à l'utilisation d'un test, mais le fait que les échantillons soient seulement de taille 10 ne facilite pas les choses (risque de faible puissance, difficulté à évaluer une loi de distribution pour définir le test à utiliser).


##3) Analyse

```{r  global_options}
knitr::opts_chunk$set( message = FALSE,
  warning = FALSE)
```


```{r package, echo=FALSE, message=FALSE, warning=FALSE}

library(dplyr)
library(ggplot2)
library(knitr)
library(kableExtra)
library(boot)
```


```{r import, echo=FALSE}
ros <- read.csv2("data/ROS_cdv.csv")

```

###3.1) Visualisation des moyennes

Les moyennes des échantillons sont :

```{r moy, echo=FALSE}



avg <- ros %>%
  group_by(Group) %>%
  summarise (avg = mean(Response))
kable(avg, "html") %>%
   kable_styling(bootstrap_options = "striped", full_width = F, position="left")


```

```{r viz raw data, echo=FALSE}

ggplot(ros, aes(y=Response, x=Group, colour=Group, fill=Group))+
  geom_jitter(size=5)+
  geom_boxplot(coef = 0, alpha=0.3, outlier.size=0)+
  scale_y_continuous(limits=c(0,175))


```


###3.2) Calcul des ratios basal / stimulé observés



Les ratios observés sont:

```{r ratio, echo=FALSE}

R_Control <- round(avg$avg[1]/avg$avg[2],2)
R_HTO <- round(avg$avg[3]/avg$avg[4],2)

Ratio_df <- data.frame(Condition=c("Control","HTO"), r=c(R_Control,R_HTO))
kable(Ratio_df, "html") %>%
   kable_styling(bootstrap_options = "striped", full_width = F, position="left")

```

###3.3) Calcul des intervalles de confiance des ratio par bootstrap

```{r fonction statistic}

# fonction "statistic" utilisée dans la fonction boot pour calculer l'IC du ratio
ratioMoy <- function(data, indice)
{
  data.star <- data[indice]
  moy_b.star <- mean(data.star[1:10]) # moyenne de l'activity basal
  moy_s.star <- mean(data.star[11:20])# moyenne de l'activity stimulated
  Ratio.star <- moy_b.star/moy_s.star # calcul du ratio = le paramèter d'intérêt
}
```

#### 3.3.1)   IC du ratio en condition Control

```{r IC condition control, echo=FALSE}

# création du fichier de données Control
ros_Cont <- ros %>%
  filter(Condition=="Control")

# bootstrap : strata sert à faire du bootstrap à l'interieur de chaque modalité de la variable Activity
boot_Cont <- boot(ros_Cont$Response, statistic=ratioMoy, strata=ros_Cont$Activity, R=4999)

boot_Cont

boot.ci(boot_Cont)

```


#### 3.3.2)   IC du ratio en condition HTO



```{r IC condition HTO, echo= FALSE}


ros_HTO <- ros %>%
  filter(Condition=="HTO")

boot_HTO <- boot(ros_HTO$Response, statistic=ratioMoy, strata=ros_HTO$Activity, R=4999)
boot_HTO
boot.ci(boot_HTO)



```


#### 3.3.3) Visualisation (intervales BCa)
```{r df}

Ratio_df$lower <-round(c(boot.ci(boot_Cont)$bca[4], boot.ci(boot_HTO)$bca[4]),2)
Ratio_df$upper <-round(c(boot.ci(boot_Cont)$bca[5], boot.ci(boot_HTO)$bca[5]),2)


ggplot(Ratio_df, aes(y=r,x=Condition, colour=Condition))+
  geom_point(size=5)+
  geom_errorbar(aes(ymin=lower, ymax=upper), width=0.2)+
  scale_y_continuous(limits=c(0,1))

```

La comparaison des intervalles de confiances à 95% ne permet pas de mettre en évidence de différence statistiquement significative entre les 2 ratios.

